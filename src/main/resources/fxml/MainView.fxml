<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.text.TextFlow?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.dota2assistant.ui.controller.MainController"
            prefWidth="1280" prefHeight="900">

    <top>
        <VBox spacing="5">
            <padding>
                <Insets top="10" right="10" bottom="5" left="10"/>
            </padding>
            
            <HBox spacing="10" alignment="CENTER_LEFT">
                <MenuBar HBox.hgrow="ALWAYS">
                    <Menu text="File">
                        <MenuItem text="New Draft" onAction="#onNewDraft"/>
                        <MenuItem text="Reset" onAction="#onResetDraft"/>
                        <SeparatorMenuItem />
                        <MenuItem text="Save Draft" onAction="#onSaveDraft"/>
                        <MenuItem text="Load Draft" onAction="#onLoadDraft"/>
                        <SeparatorMenuItem />
                        <MenuItem text="Preferences" onAction="#onShowPreferences"/>
                        <SeparatorMenuItem />
                        <MenuItem text="Exit" onAction="#onExit"/>
                    </Menu>
                    <Menu text="Data">
                        <MenuItem text="Refresh Hero Data" onAction="#onRefreshHeroData"/>
                        <MenuItem text="Update Match Data" onAction="#onUpdateMatchData"/>
                        <MenuItem text="Update Player Stats" onAction="#onUpdatePlayerStats"/>
                    </Menu>
                    <Menu text="Help">
                        <MenuItem text="About" onAction="#onShowAbout"/>
                    </Menu>
                </MenuBar>
                
                <!-- User Status Component -->
                <fx:include source="components/UserStatusView.fxml" fx:id="userStatusContainer" />
            </HBox>
            
            <Separator />
        </VBox>
    </top>
    
    <center>
        <!-- Main Tab Panel -->
        <TabPane fx:id="mainTabPane" tabClosingPolicy="UNAVAILABLE">
                <!-- Admin Tab -->
                <Tab text="Admin" fx:id="adminTab">
                    <fx:include source="components/AdminMonitoringView.fxml" />
                </Tab>
                
                <!-- Draft Tab -->
                <Tab text="Draft" fx:id="draftTab">
                    <BorderPane>
                        <top>
                            <VBox spacing="5">
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <padding>
                                        <Insets top="5" right="5" bottom="5" left="5"/>
                                    </padding>
                                    
                                    <Label text="Draft Mode:" />
                                    <ComboBox fx:id="draftModeComboBox" />
                                    
                                    <Separator orientation="VERTICAL" />
                                    
                                    <Label text="Pick Order:" />
                                    <ComboBox fx:id="pickOrderComboBox" />
                                    
                                    <Separator orientation="VERTICAL" />
                                    
                                    <Label text="Side:" />
                                    <ComboBox fx:id="mapSideComboBox" />
                                    
                                    <Separator orientation="VERTICAL" />
                                    
                                    <Label text="Opponent Level:" />
                                    <ComboBox fx:id="opponentLevelComboBox" />
                                    
                                    <Separator orientation="VERTICAL" />
                                    
                                    <CheckBox fx:id="timedModeCheckBox" text="Timed Mode" />
                                    
                                    <Region HBox.hgrow="ALWAYS" />
                                    
                                    <Button fx:id="startEndDraftButton" text="Start Draft" onAction="#onStartEndDraft" />
                                </HBox>
                                
                                <Separator />
                                
                                <!-- Win Probability Visualization -->
                                <HBox spacing="5" alignment="CENTER" maxWidth="980">
                                    <padding>
                                        <Insets top="5" right="5" bottom="5" left="5"/>
                                    </padding>
                                    
                                    <Label text="Radiant" style="-fx-text-fill: -radiant; -fx-font-weight: bold;" />
                                    
                                    <!-- Custom StackPane to create a two-colored progress bar -->
                                    <StackPane HBox.hgrow="ALWAYS">
                                        <ProgressBar fx:id="winProgressBackground" progress="1.0" style="-fx-accent: #C23C2A;" maxWidth="Infinity" prefHeight="20" />
                                        <ProgressBar fx:id="radiantWinBar" progress="0.5" style="-fx-accent: #92A525;" maxWidth="Infinity" prefHeight="20" />
                                        <Label fx:id="winPercentageLabel" text="50% - 50%" style="-fx-font-weight: bold; -fx-text-fill: white;" />
                                    </StackPane>
                                    
                                    <Label text="Dire" style="-fx-text-fill: -dire; -fx-font-weight: bold;" />
                                </HBox>
                            </VBox>
                        </top>
                        
                        <center>
                            <HBox spacing="10">
                                <padding>
                                    <Insets top="5" right="5" bottom="5" left="5"/>
                                </padding>
                                
                                <!-- Left Column - Radiant Team -->
                                <VBox spacing="10" alignment="TOP_CENTER" HBox.hgrow="ALWAYS" maxWidth="250">
                                    <Label text="Radiant Team" style="-fx-font-weight: bold;" />
                                    
                                    <GridPane fx:id="radiantPicksGrid" alignment="CENTER" hgap="5" vgap="5">
                                        <!-- Heroes will be added here dynamically -->
                                    </GridPane>
                                    
                                    <Separator />
                                    
                                    <Label text="Bans" />
                                    <FlowPane fx:id="radiantBansPane" hgap="5" vgap="5" />
                                </VBox>
                                
                                <!-- Center - Hero Selection -->
                                <VBox spacing="10" HBox.hgrow="ALWAYS">
                                    <Label text="Available Heroes" style="-fx-font-weight: bold;" />
                                    
                                    <HBox spacing="10">
                                        <TextField fx:id="heroSearchField" promptText="Search heroes..." HBox.hgrow="ALWAYS" />
                                        <ComboBox fx:id="heroFilterComboBox" />
                                    </HBox>
                                    
                                    <ScrollPane VBox.vgrow="ALWAYS" fitToWidth="false" fitToHeight="true" hbarPolicy="NEVER" vbarPolicy="ALWAYS">
                                        <FlowPane fx:id="heroSelectionPane" hgap="10" vgap="10">
                                            <!-- Heroes will be added here dynamically -->
                                        </FlowPane>
                                    </ScrollPane>
                                    
                                    <HBox spacing="10" alignment="CENTER">
                                        <Button fx:id="actionButton" text="Select Action" onAction="#onHeroAction" HBox.hgrow="ALWAYS" maxWidth="Infinity" />
                                    </HBox>
                                    
                                    <!-- Debug buttons for direct ban/pick functionality -->
                                    <HBox spacing="10" alignment="CENTER">
                                        <Button text="Force Ban Selected" onAction="#onForceBanHero" HBox.hgrow="ALWAYS" maxWidth="Infinity" />
                                        <Button text="Force Pick Selected" onAction="#onForcePickHero" HBox.hgrow="ALWAYS" maxWidth="Infinity" />
                                    </HBox>
                                </VBox>
                                
                                <!-- Right Column - Dire Team -->
                                <VBox spacing="10" alignment="TOP_CENTER" HBox.hgrow="ALWAYS" maxWidth="250">
                                    <Label text="Dire Team" style="-fx-font-weight: bold;" />
                                    
                                    <GridPane fx:id="direPicksGrid" alignment="CENTER" hgap="5" vgap="5">
                                        <!-- Heroes will be added here dynamically -->
                                    </GridPane>
                                    
                                    <Separator />
                                    
                                    <Label text="Bans" />
                                    <FlowPane fx:id="direBansPane" hgap="5" vgap="5" />
                                </VBox>
                            </HBox>
                        </center>
                        
                        <right>
                            <VBox spacing="10" minWidth="350" maxWidth="350">
                                <padding>
                                    <Insets top="5" right="5" bottom="5" left="5"/>
                                </padding>
                                
                                <Label text="Draft Analysis" style="-fx-font-weight: bold;" />
                                
                                <TitledPane text="Suggestions" expanded="true">
                                    <VBox spacing="5">
                                        <Label text="Recommended Picks:" />
                                        <ListView fx:id="recommendedPicksListView" prefHeight="150" VBox.vgrow="ALWAYS" />
                                        
                                        <Label text="Recommended Bans:" />
                                        <ListView fx:id="recommendedBansListView" prefHeight="150" VBox.vgrow="ALWAYS" />
                                    </VBox>
                                </TitledPane>
                                
                                <TitledPane text="Team Analysis" expanded="true">
                                    <VBox spacing="5">
                                        <Label text="Radiant Strength: " />
                                        <ProgressBar fx:id="radiantStrengthBar" progress="0.5" maxWidth="Infinity" />
                                        
                                        <Label text="Dire Strength: " />
                                        <ProgressBar fx:id="direStrengthBar" progress="0.5" maxWidth="Infinity" />
                                        
                                        <Separator />
                                        
                                        <TextArea fx:id="analysisTextArea" prefHeight="150" wrapText="true" editable="false" />
                                    </VBox>
                                </TitledPane>
                                
                                <TitledPane text="Draft Timeline" expanded="true">
                                    <ListView fx:id="draftTimelineListView" prefHeight="150" />
                                </TitledPane>
                            </VBox>
                        </right>
                    </BorderPane>
                </Tab>
                
                <!-- Player Profile Tab -->
                <Tab text="Player Profile" fx:id="playerProfileTab">
                    <BorderPane>
                        <center>
                            <VBox spacing="15" alignment="TOP_CENTER">
                                <padding>
                                    <Insets top="20" right="20" bottom="20" left="20"/>
                                </padding>
                                
                                <!-- Player stats header -->
                                <HBox spacing="15" alignment="CENTER_LEFT">
                                    <StackPane minWidth="80" minHeight="80" maxWidth="80" maxHeight="80">
                                        <ImageView fx:id="playerAvatarLarge" fitHeight="80" fitWidth="80" preserveRatio="true">
                                            <image>
                                                <Image url="@/images/placeholder.png" />
                                            </image>
                                        </ImageView>
                                    </StackPane>
                                    
                                    <VBox spacing="5">
                                        <Label fx:id="playerNameLabel" text="Player Name" style="-fx-font-size: 24px; -fx-font-weight: bold;"/>
                                        <HBox spacing="15">
                                            <Label text="Steam ID: " style="-fx-font-weight: bold;"/>
                                            <Label fx:id="steamIdLabel" text="Not logged in"/>
                                            
                                            <Separator orientation="VERTICAL"/>
                                            
                                            <Label text="Account Level: " style="-fx-font-weight: bold;"/>
                                            <Label fx:id="accountLevelLabel" text="--"/>
                                        </HBox>
                                    </VBox>
                                    
                                    <Region HBox.hgrow="ALWAYS"/>
                                    
                                    <Button fx:id="updateMatchesButton" text="Update Matches" onAction="#onUpdateMatches"/>
                                    <Button fx:id="refreshProfileButton" text="Refresh Profile" onAction="#onRefreshProfile"/>
                                </HBox>
                                
                                <Separator/>
                                
                                <!-- Notification area for match processing errors -->
                                <VBox fx:id="matchNotificationArea" spacing="5" visible="false" managed="false">
                                    <HBox alignment="CENTER_LEFT" spacing="10" styleClass="notification-header">
                                        <padding>
                                            <Insets top="5" right="10" bottom="5" left="10"/>
                                        </padding>
                                        <Label fx:id="matchNotificationLabel" text="Match Processing Issues" style="-fx-font-weight: bold;"/>
                                        <Region HBox.hgrow="ALWAYS"/>
                                        <Button fx:id="dismissNotificationButton" text="Dismiss" onAction="#onDismissNotification" />
                                    </HBox>
                                    <TextFlow fx:id="matchErrorsTextFlow" styleClass="notification-content" maxHeight="80">
                                        <padding>
                                            <Insets top="5" right="10" bottom="5" left="10"/>
                                        </padding>
                                    </TextFlow>
                                </VBox>
                                
                                <!-- Sync Settings Component -->
                                <fx:include source="components/SyncSettingsView.fxml" fx:id="syncSettingsContainer" />
                                
                                <Separator/>
                                
                                <!-- Statistics tabs -->
                                <TabPane fx:id="profileTabPane" VBox.vgrow="ALWAYS" tabClosingPolicy="UNAVAILABLE">
                                    <!-- Hero Stats Tab -->
                                    <Tab text="Hero Stats">
                                        <VBox spacing="10">
                                            <HBox spacing="10" alignment="CENTER_LEFT">
                                                <TextField fx:id="heroSearchField" promptText="Search Heroes..." HBox.hgrow="ALWAYS"/>
                                                <ComboBox fx:id="heroStatsFilterComboBox" promptText="Filter"/>
                                            </HBox>
                                            
                                            <TableView fx:id="heroStatsTable" VBox.vgrow="ALWAYS">
                                                <columns>
                                                    <TableColumn text="Hero"/>
                                                    <TableColumn text="Matches"/>
                                                    <TableColumn text="Win Rate"/>
                                                    <TableColumn text="KDA"/>
                                                    <TableColumn text="Last Played"/>
                                                </columns>
                                            </TableView>
                                        </VBox>
                                    </Tab>
                                    
                                    <!-- Recent Matches Tab -->
                                    <Tab text="Recent Matches">
                                        <TableView fx:id="recentMatchesTable" VBox.vgrow="ALWAYS">
                                            <columns>
                                                <TableColumn text="Date"/>
                                                <TableColumn text="Hero"/>
                                                <TableColumn text="Result"/>
                                                <TableColumn text="Duration"/>
                                                <TableColumn text="KDA"/>
                                                <TableColumn text="Mode"/>
                                            </columns>
                                        </TableView>
                                    </Tab>
                                    
                                    <!-- Performance Trends Tab -->
                                    <Tab text="Performance Trends">
                                        <BorderPane>
                                            <center>
                                                <Label text="Performance trends graphs will be displayed here" 
                                                       alignment="CENTER" style="-fx-font-style: italic;"/>
                                            </center>
                                        </BorderPane>
                                    </Tab>
                                </TabPane>
                            </VBox>
                        </center>
                    </BorderPane>
                </Tab>
                
                <!-- Live Assistant Tab -->
                <Tab text="Live Assistant" fx:id="liveAssistantTab">
                    <BorderPane>
                        <top>
                            <VBox spacing="10" alignment="CENTER">
                                <padding>
                                    <Insets top="20" right="20" bottom="10" left="20"/>
                                </padding>
                                
                                <Label text="Live Draft Assistant" style="-fx-font-size: 20px; -fx-font-weight: bold;"/>
                                
                                <HBox spacing="15" alignment="CENTER">
                                    <Button fx:id="connectToGameButton" text="Connect to Dota 2" 
                                            styleClass="primary-button" onAction="#onConnectToGame"/>
                                            
                                    <Label fx:id="gameConnectionStatus" text="Not Connected" 
                                           style="-fx-font-weight: bold; -fx-text-fill: #ff4d4d;"/>
                                </HBox>
                                
                                <Separator/>
                            </VBox>
                        </top>
                        
                        <center>
                            <VBox alignment="CENTER" spacing="20">
                                <padding>
                                    <Insets top="40" right="20" bottom="20" left="20"/>
                                </padding>
                                
                                <Label text="This feature is coming soon!" 
                                       style="-fx-font-size: 22px; -fx-font-weight: bold;"/>
                                       
                                <Label text="The Live Assistant will automatically detect when you're in a Dota 2 draft and provide real-time suggestions."
                                       wrapText="true" maxWidth="600" textAlignment="CENTER"/>
                                       
                                <Label text="Features will include:"
                                       style="-fx-font-weight: bold; -fx-font-size: 16px;"/>
                                       
                                <VBox spacing="5" alignment="CENTER_LEFT" maxWidth="450">
                                    <Label text="• Real-time hero recommendations based on the current draft"/>
                                    <Label text="• Counter-pick suggestions against enemy selections"/>
                                    <Label text="• Role and lane suggestions for your team composition"/>
                                    <Label text="• Ban recommendations based on meta and enemy player history"/>
                                    <Label text="• Integration with player statistics from your matches"/>
                                </VBox>
                            </VBox>
                        </center>
                    </BorderPane>
                </Tab>
            </TabPane>
    </center>
    
    <bottom>
        <HBox alignment="CENTER_LEFT" spacing="10">
            <padding>
                <Insets top="10" right="15" bottom="10" left="15"/>
            </padding>
            
            <Label fx:id="statusLabel" text="Ready" style="-fx-font-size: 14px; -fx-font-weight: bold;" />
            <Region HBox.hgrow="ALWAYS" />
            <Label fx:id="timerLabel" text="00:00" style="-fx-font-size: 16px; -fx-font-weight: bold;" />
        </HBox>
    </bottom>

</BorderPane>